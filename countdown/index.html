<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>Museum Display Manager</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap');

        * {
            margin: 0;
            padding: 0;
        }

        body {
            overflow: hidden;
            background: #000;
            color: #fff;
            height: 100vh;
            width: 100vw;

            /* font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans", sans-serif; */
            font-family: "Noto Sans JP", sans-serif;
            font-optical-sizing: auto;
            /* font-weight: <weight>; */
            font-style: normal;
        }

        #display-frame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 0;
        }

        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            pointer-events: none;
        }

        .time {
            font-size: 15vw;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        }

        .date {
            font-size: 6vw;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
        }

        #status-overlay {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 15px 20px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
            font-family: 'Courier New', monospace;
            min-width: 200px;
            display: none;
        }

        #status-overlay.debug {
            display: block;
        }
    </style>
</head>

<body>
    <iframe id="display-frame"></iframe>
    <div id="ui-overlay">
        <div class="time" id="time">00:00:00</div>
        <div class="date" id="date">0000/00/00</div>
    </div>
    <div id="status-overlay">
        <div>Current View: <span id="current-view">--</span></div>
        <div>Time: <span id="current-time">--:--:--</span></div>
        <div>Next Switch: <span id="next-switch">--:--</span></div>
    </div>

    <script>
        // ====================================
        // Schedule Configuration
        // ====================================
        const SCHEDULE = [
            { hour: 9, minute: 0, second: 0, view: 'time' },
            { hour: 10, minute: 0, second: 0, view: 'time_quotes' },
            { hour: 12, minute: 0, second: 0, view: 'countdown' },
            { hour: 12, minute: 30, second: 0, view: 'time_quotes' },
            { hour: 13, minute: 0, second: 0, view: 'time' },
            { hour: 13, minute: 30, second: 0, view: 'time_quotes' },
        ]

        // ====================================
        // Display Manager
        // ====================================
        class DisplayManager {
            constructor() {
                this.currentView = null;
                this.lastCheckSecond = -1;
                this.debugMode = false; // URLパラメータで ?debug=1 で有効化
            }

            init() {
                this.debugMode = new URLSearchParams(window.location.search).has('debug');

                if (this.debugMode) {
                    document.getElementById('status-overlay').classList.add('debug');
                }

                console.log('[DisplayManager] Initialized', { debugMode: this.debugMode });
                this.loadView();
                this.startTimeMonitor();
            }

            loadView() {
                const view = this.getCurrentView();
                if (this.currentView === view) return;

                this.currentView = view;
                let viewFile;
                if (view === 'time') {
                    viewFile = 'time.html';
                } else if (view === 'countdown') {
                    viewFile = 'countdown.html';
                } else if (view === 'time_quotes') {
                    viewFile = 'time_quotes.html';
                } else {
                    viewFile = 'time.html'; // デフォルト
                }

                const frame = document.getElementById('display-frame');

                console.log(`[DisplayManager] Loading view: ${view} (${viewFile})`);
                frame.src = viewFile;

                this.updateStatus();
            }

            getCurrentView() {
                const now = new Date();
                const currentSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
                let activeView = SCHEDULE[0].view;

                for (let s of SCHEDULE) {
                    const scheduleSeconds = s.hour * 3600 + s.minute * 60 + (s.second || 0);
                    if (currentSeconds >= scheduleSeconds) {
                        activeView = s.view;
                    }
                }
                return activeView;
            }

            getNextSwitchTime() {
                const now = new Date();
                const currentSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

                for (let s of SCHEDULE) {
                    const scheduleSeconds = s.hour * 3600 + s.minute * 60 + (s.second || 0);
                    if (scheduleSeconds > currentSeconds) {
                        return {
                            hour: s.hour,
                            minute: s.minute,
                            second: s.second || 0
                        };
                    }
                }

                // 次の日の最初のスケジュール
                const nextSchedule = SCHEDULE[0];
                return {
                    hour: nextSchedule.hour,
                    minute: nextSchedule.minute,
                    second: nextSchedule.second || 0,
                    nextDay: true
                };
            }

            startTimeMonitor() {
                setInterval(() => {
                    const now = new Date();
                    const currentSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

                    if (this.lastCheckSecond !== currentSeconds) {
                        this.lastCheckSecond = currentSeconds;
                        this.loadView();
                    }

                    this.updateStatus();
                }, 100); // 100ms間隔で監視（秒単位の変更を素早く検出）
            }

            updateStatus() {
                const now = new Date();
                const h = String(now.getHours()).padStart(2, '0');
                const m = String(now.getMinutes()).padStart(2, '0');
                const s = String(now.getSeconds()).padStart(2, '0');

                const yyyy = now.getFullYear();
                const MM = String(now.getMonth() + 1).padStart(2, "0");
                const dd = String(now.getDate()).padStart(2, "0");

                // 曜日を英語短縮形で取得
                const dayNames = ["Sun.", "Mon.", "Tue.", "Wed.", "Thu.", "Fri.", "Sat."];
                const dayName = dayNames[now.getDay()];

                document.getElementById('time').textContent = `${h}:${m}:${s}`;
                document.getElementById('date').textContent = `${yyyy}/${MM}/${dd} ${dayName}`;

                document.getElementById('current-view').textContent = this.currentView;
                document.getElementById('current-time').textContent = `${h}:${m}:${s}`;

                const next = this.getNextSwitchTime();
                const nextHour = String(next.hour).padStart(2, '0');
                const nextMinute = String(next.minute).padStart(2, '0');
                const nextSecond = String(next.second).padStart(2, '0');
                document.getElementById('next-switch').textContent = `${nextHour}:${nextMinute}:${nextSecond}${next.nextDay ? ' (明日)' : ''}`;
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            const manager = new DisplayManager();
            manager.init();
        });
    </script>
</body>

</html>